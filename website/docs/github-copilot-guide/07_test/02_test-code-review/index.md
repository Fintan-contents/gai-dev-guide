---
sidebar_position: 2
---

# テストコードをレビューする

:::note
本ページは、GitHub Copilot ChatのAgent Modeが一般提供となった後に統廃合する可能性があります。
:::

ここでは、GitHub Copilotにテストコードのレビューをサポートしてもらい、レビュー効率を高める方法を記載します。
AIが生成したテストコードのレビューはもちろん、人が作成したテストコードのレビューにも活用できます。

## 定型的なレビューを行う

テストコードにも、プロジェクトで定められたテストコード標準やテストフレームワークの作法など、遵守すべきルールが存在します。
このような観点でのレビューはAIに任せることで、人はより本質的なレビューに集中できます。

:::info 使用するGitHub Copilot ChatのMode
Ask Modeを使います。
:::

基本的な進め方は、[ソースコードの定型的なレビューを行う](../../../programming/code-review)場合と同じです。

レビューしたいテストコードを開き、レビュー観点別に用意したプロンプトを[Promptis](https://marketplace.visualstudio.com/items?itemName=tis.promptis)で一括実行します。
たとえば、「テストの命名規則」、「アサーションの適切さ」、「テストデータの妥当性」といった観点ごとにプロンプトを用意し、一括でレビューを実行することで、網羅的かつ効率的なレビューが可能になります。

## テスト観点でレビューを行う

定型的なレビューの後は、テストコードが実施したいテスト仕様を網羅しているか、テストケースの内容が妥当かを確認する必要があります。

:::info 使用するGitHub Copilot ChatのMode
Ask Modeを使います。
:::

人がレビューすることも重要ですが、AIにレビューさせることで人によるレビューでの見落とし防止や多角的な視点での確認が期待できます。

以下のような[プロンプトファイル](../../../04_ai-on-boarding/02_shared-instructions-prompts/index.md)を用意しておき、Chatウィンドウで呼び出します。

```markdown
---
mode: "ask"
description: "テストコードがテスト仕様書に定義された仕様を満たしているかレビューしてください"
---

# 前提

このプロンプトファイルには入力変数が含まれます。
プロンプトファイルを呼び出しに、入力変数のいずれかが未指定の場合はプロンプトの実行を中止し、ユーザーに入力変数の指定を指示してください。

# 指示

テスト仕様書 ${input:spec} と設計書 ${input:doc} の内容を確認して、現在開いているテストコードが必要なテストを実装しているかレビューしてください。  
特に、テストケースの網羅性や、テストデータ、アサーションが適切かどうかの観点で確認してください。

指摘は箇条書きで記載してください。
```

ここで、プロンプトファイルおよびプロンプトに指定すべき変数の値を以下と仮定します。

- プロンプトファイル: `.github/prompts/review-test.prompt.md`
- テスト仕様書（`${input:spec}`）: `#file:ユーザー登録機能テスト仕様書.md`
- 設計書（`${input:doc}`）: `#file:ユーザー登録機能.md`

:::info ポイント
`#file`は[Visual Studio Codeでファイルをコンテキストに追加する変数](https://code.visualstudio.com/docs/copilot/reference/copilot-vscode-features)です。
:::

この時、Chatウィンドウでは以下のように指示します。

```
/review-test spec=#file:ユーザー登録機能テスト仕様書.md doc=#file:ユーザー登録機能.md
```

AIからのフィードバックを参考に、テストコードを修正・改善します。
これによりテストコードの品質を高め、テストの見落としを防ぐことができます。

ただし、ソースコードのレビューと同様に、最終的な成果物責任は人にあることを忘れないようにしましょう。

